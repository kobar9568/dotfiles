/* Tested: Firefox 146.0.1 on Windows 11 */

/* 日本語IMEが有効なキーボードでURLバーにフォーカスした際に全角に切り替える (デフォルトでは半角になることへの対処) */
*|*#urlbar *|input,
*|*#searchbar *|input {
  ime-mode: active !important;
}

/* タブの最小幅制限を解除 */
.tabbrowser-tab {
  min-width: initial !important;
}
.tab-content {
  overflow: hidden !important;
}

/* ウインドウモード時にのみタブ左側に表示される謎の空白を削除 */
/* タブの左側の要素を消した場合、タブ数が多くなるとウインドウが掴めなくなるので注意 */
.titlebar-spacer {
  width: 0px !important;
}

/* タブバー左側に余白 */
.toolbar-items {
  margin-right: 48px;
}

/* Code by GPT-5.2 */
/* 閉じるボタンを右側に固定+タブ幅現象時はタイトル・faviconに重なる */
/* 基準 */
.tabbrowser-tab .tab-content {
  position: relative !important;
  display: flex;
  align-items: center;
}

/* ラベル(タイトル)側：縮められる + はみ出たら隠す */
.tabbrowser-tab .tab-label-container {
  min-width: 0 !important;
  overflow: hidden !important;
}

/* タイトル：省略も効かせる */
.tabbrowser-tab .tab-label {
  overflow: hidden !important;
  text-overflow: ellipsis !important;
  white-space: nowrap !important;
}

/* 閉じるボタン：右端固定＆前面 */
.tabbrowser-tab .tab-close-button {
  position: absolute !important;
  right: 8px !important;
  top: 50% !important;
  transform: translateY(-50%) !important;
  z-index: 10 !important;   /* ← “バツが最優先” */
  box-sizing: border-box !important;
}

/* ここが肝：タイトル(ラベル領域)は右側を閉じる分だけ「クリップ」する */
.tabbrowser-tab .tab-content {
  padding-right: 26px !important; /* close 18 + 余白 */
}

/* タブ内を “幅で条件分岐できるコンテナ” にする */
.tabbrowser-tab .tab-content {
  container-type: inline-size !important;
  position: relative !important;
  display: flex;
  align-items: center;
}

/* ★ container は tabbrowser-tab に付ける */
.tabbrowser-tab {
  container-type: inline-size !important;
}

/* 非アクティブは基本 0（極小化優先） */
.tabbrowser-tab:not([selected="true"]):not([visuallyselected="true"]):not([visuallyselected]) .tab-content {
  padding-right: 0 !important;
}

/* ★非アクティブでも「幅がある時だけ」close 分の余白を入れる */
/* 非アクティブ、かつ閉じるボタンが表示されている間のみ、padding-rightを入れることでページタイトルと閉じるボタンが重なることを防止 */
@container (min-width: 1px) {
  .tabbrowser-tab:not([selected="true"]):not([visuallyselected="true"]):not([visuallyselected]) .tab-content {
    padding-right: 26px !important;
  }
}

/* ★狭くなったら favicon を消す（ここが本題） */
@container (max-width: 18px) {
  .tabbrowser-tab[selected="true"] .tab-icon-image,
  .tabbrowser-tab[visuallyselected="true"] .tab-icon-image,
  .tabbrowser-tab[visuallyselected] .tab-icon-image {
    display: none !important;
  }
  /* favicon消した分、タイトルを左に詰めたいなら余白も調整 */
  .tab-label-container {
    margin-inline-start: 0 !important;
  }
}

/* アクティブタブだけ：×ボタンが潰れない最低幅を確保 */
.tabbrowser-tab[selected="true"],
.tabbrowser-tab[visuallyselected="true"],
.tabbrowser-tab[visuallyselected] {
  min-width: 36px !important; /* まずは 40px。大きければ 36px まで下げてもOK */
}

/* アクティブだけ close 分の余白 */
.tabbrowser-tab[selected="true"] .tab-content,
.tabbrowser-tab[visuallyselected="true"] .tab-content,
.tabbrowser-tab[visuallyselected] .tab-content{
  padding-right: 26px !important;
}

/* コンテキストメニュー in viewport */
#context-inspect-a11y { /* Inspect Accessibility Properties */
  display: none;
}

/* コンテキストメニュー in ブックマーク・履歴 */
#placesContext_open { /* Open */
  display: none;
}

/* アドレスバー右側: 拡張機能による追加アイコン */
#pageAction-urlbar-_testpilot-containers { /* Firefox Multi-Account Containers */
  display: none;
}
